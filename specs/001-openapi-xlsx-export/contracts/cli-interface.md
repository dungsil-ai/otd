# CLI Interface Contract: otd

**Date**: 2026-01-15
**Feature**: 001-openapi-xlsx-export

## 명령어 개요

- **명령어 이름**: `otd`
- **의미**: **O**penAPI **T**o **D**ocument
- **설명**: OpenAPI v3 문서를 XLSX 형식의 API 명세서로 변환하는 CLI 도구

## 명령어 구조

```
otd [options] <input>
```

## 인자

| 인자 | 필수 | 설명 |
|------|------|------|
| `<input>` | 예 | OpenAPI v3 문서 파일 경로 (YAML 또는 JSON) |

### 입력 파일 요구사항

- **지원 확장자**: `.yaml`, `.yml`, `.json`
- **지원 버전**: OpenAPI 3.0.x, 3.1.x
- **경로 형식**: 상대 경로, 절대 경로 모두 지원
- **특수 문자**: 공백이나 특수 문자가 포함된 경로는 따옴표로 감싸서 지정

## 옵션

| 옵션 | 단축 | 인자 | 기본값 | 설명 |
|------|------|------|--------|------|
| `--output` | `-o` | `<path>` | 입력 파일명.xlsx | 출력 파일 경로 |
| `--force` | `-f` | - | - | 기존 파일 덮어쓰기 허용 |
| `--help` | `-h` | - | - | 도움말 표시 |
| `--version` | `-v` | - | - | 버전 정보 표시 |

### 옵션 동작 세부사항

- **옵션 순서**: 순서에 관계없이 동일하게 동작
- **우선순위**: `--help`, `--version`이 다른 옵션/인자와 함께 사용되면 해당 정보만 출력하고 종료
- **알 수 없는 옵션**: 오류 메시지와 함께 사용법 힌트를 표시하고 종료 코드 1 반환

### --output 옵션 상세

| 입력 | 동작 |
|------|------|
| `--output result.xlsx` | 지정된 경로에 저장 |
| `--output result` | 자동으로 `.xlsx` 확장자 추가 → `result.xlsx` |
| `--output ./dir/` | 디렉토리만 지정 시 입력 파일명 사용 → `./dir/input.xlsx` |

### --force 옵션 상세

- 기본 동작: 출력 파일이 이미 존재하면 오류 발생
- `--force` 지정 시: 기존 파일을 경고 없이 덮어쓰기

## 사용 예시

### 기본 변환
```bash
otd openapi.yaml
# 출력: openapi.xlsx (동일 디렉토리)
```

### 출력 경로 지정
```bash
otd openapi.yaml -o ./output/api-spec.xlsx
otd openapi.json --output /tmp/result
# 출력: /tmp/result.xlsx (확장자 자동 추가)
```

### 디렉토리 지정
```bash
otd openapi.yaml -o ./docs/
# 출력: ./docs/openapi.xlsx
```

### 덮어쓰기
```bash
otd openapi.yaml -o existing.xlsx --force
```

### 도움말
```bash
otd --help
otd -h
```

### 버전
```bash
otd --version
otd -v
```

## 인자 없이 실행

인자 없이 `otd`만 실행하면:
- 필수 인자 누락 오류 메시지 표시
- 간단한 사용법 힌트 표시
- 종료 코드 1 반환

```
오류: 입력 파일이 지정되지 않았습니다.
사용법: otd [옵션] <입력파일>
자세한 정보는 'otd --help'를 실행하세요.
```

## 출력

### 출력 언어

모든 도움말, 오류 메시지, 안내 메시지는 **한국어**로 출력합니다.

### 출력 스트림

| 유형 | 스트림 |
|------|--------|
| 성공 메시지 | stdout |
| 도움말 | stdout |
| 버전 정보 | stdout |
| 오류 메시지 | stderr |
| 진행 상황 | stderr |

### 성공 시 (stdout)
```
변환 완료: ./output/api-spec.xlsx
```

### 오류 시 (stderr)
```
오류: 파일을 찾을 수 없습니다: openapi.yaml
      경로를 확인하세요.
```

### 오류 메시지 형식

모든 오류 메시지는 다음 형식을 따릅니다:
- 첫 줄: `오류: [오류 내용]`
- 둘째 줄: `      [해결 방법 안내]` (들여쓰기로 시각적 구분)

## 종료 코드

| 코드 | 설명 |
|------|------|
| 0 | 성공 (--help, --version 포함) |
| 1 | 파일 시스템 오류 (파일 없음, 권한 없음, 파일 이미 존재) |
| 2 | OpenAPI 파싱 오류 (잘못된 형식, 지원하지 않는 버전) |
| 3 | 출력 오류 (쓰기 실패) |

## 도움말 출력 형식

```
otd - OpenAPI To Document 변환 도구

사용법:
  otd [옵션] <입력파일>

인자:
  입력파일    OpenAPI v3 문서 파일 (YAML 또는 JSON)

옵션:
  -o, --output <경로>  출력 파일 경로 (기본값: 입력파일명.xlsx)
  -f, --force          기존 파일 덮어쓰기
  -h, --help           도움말 표시
  -v, --version        버전 정보 표시

예시:
  otd openapi.yaml
  otd openapi.json -o api-spec.xlsx
  otd spec.yaml -o ./docs/ --force
```

## 버전 출력 형식

```
otd v1.0.0 (2026-01-15)
```

형식: `otd v{major}.{minor}.{patch} ({빌드 날짜})`

## 크로스 플랫폼 호환성

- **경로 구분자**: OS 네이티브 방식 자동 처리 (Windows: `\`, Unix: `/`)
- **파일명 인코딩**: UTF-8 지원
- **특수 문자 경로**: 따옴표로 감싸서 처리

## 오류 메시지 상세

| 시나리오 | 메시지 | 해결 안내 |
|----------|--------|-----------|
| 파일 없음 | 파일을 찾을 수 없습니다: {path} | 경로를 확인하세요. |
| 읽기 권한 없음 | 파일을 읽을 수 없습니다: {path} | 파일 권한을 확인하세요. |
| 잘못된 형식 | 유효하지 않은 OpenAPI 문서입니다. | OpenAPI v3 형식인지 확인하세요. |
| 버전 미지원 | OpenAPI v2는 지원하지 않습니다. | v3로 변환 후 다시 시도하세요. |
| 파일 존재 | 출력 파일이 이미 존재합니다: {path} | --force 옵션을 사용하거나 다른 경로를 지정하세요. |
| 쓰기 권한 없음 | 출력 파일을 저장할 수 없습니다: {path} | 디렉토리 권한을 확인하세요. |
| 알 수 없는 옵션 | 알 수 없는 옵션: {option} | 'otd --help'로 사용 가능한 옵션을 확인하세요. |
| 인자 누락 | 입력 파일이 지정되지 않았습니다. | 'otd --help'를 실행하세요. |
