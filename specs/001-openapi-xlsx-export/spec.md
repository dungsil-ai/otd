# Feature Specification: OpenAPI to XLSX Export

**Feature Branch**: `001-openapi-xlsx-export`  
**Created**: 2026-01-15  
**Status**: Draft  
**Input**: User description: "OpenAPI v3 문서를 테이블 명세서와 유사한 구조의 API 명세서(XLSX 형식)으로 출력하는 CLI 프로그램"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 기본 변환 (Priority: P1)

사용자가 OpenAPI v3 문서 파일을 명령줄 도구(`otd`)로 실행하여 스프레드시트 형식의 API 명세서를 생성한다.
변환된 문서는 API 항목별로 테이블 형태로 정리되어 비기술 이해관계자와 공유하기 쉽다.

**Why this priority**: 핵심 기능이며, 이 기능만으로도 사용자에게 실질적인 가치를 제공한다.

**Independent Test**: OpenAPI 문서 하나를 입력으로 주고 스프레드시트 파일이 올바르게 생성되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 유효한 OpenAPI v3 문서 파일이 있을 때, **When** 도구에서 해당 파일을 입력으로 실행하면, **Then** 동일 디렉토리에 스프레드시트 파일이 생성된다
2. **Given** 변환이 완료되었을 때, **When** 스프레드시트 파일을 열면, **Then** API 항목 정보가 테이블 형태로 정리되어 있다

---

### User Story 2 - 출력 경로 지정 (Priority: P2)

사용자가 출력 파일의 저장 위치와 이름을 지정할 수 있다. 기본 동작은 입력 파일과 동일한 위치에 같은 이름으로 확장자만 변경하여 저장한다.

**Why this priority**: 파일 관리의 유연성을 제공하여 업무 흐름 통합을 용이하게 한다.

**Independent Test**: 출력 경로 옵션을 지정하여 원하는 위치에 파일이 생성되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** OpenAPI 파일과 출력 경로 옵션이 있을 때, **When** 도구를 실행하면, **Then** 지정된 경로에 스프레드시트 파일이 생성된다
2. **Given** 출력 경로가 지정되지 않았을 때, **When** 도구를 실행하면, **Then** 입력 파일과 동일한 디렉토리에 동일한 이름으로 저장된다
3. **Given** 출력 경로에 확장자가 없을 때, **When** 도구를 실행하면, **Then** `.xlsx` 확장자가 자동으로 추가된다
4. **Given** 출력 경로가 디렉토리만 지정되었을 때, **When** 도구를 실행하면, **Then** 해당 디렉토리에 입력 파일명으로 저장된다

---

### User Story 3 - 오류 처리 및 피드백 (Priority: P3)

사용자가 잘못된 파일이나 존재하지 않는 파일을 입력했을 때 명확한 오류 메시지를 받는다. 변환 진행 상황과 완료 메시지도 표시된다. 모든 메시지는 한국어로 제공된다.

**Why this priority**: 사용자 경험 향상 및 문제 해결 용이성을 위해 필요하다.

**Independent Test**: 다양한 오류 시나리오에서 적절한 메시지가 표시되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 존재하지 않는 파일 경로가 입력될 때, **When** 도구를 실행하면, **Then** "파일을 찾을 수 없습니다" 오류 메시지와 해결 안내가 표시되고 오류 상태로 종료된다
2. **Given** OpenAPI 형식이 아닌 파일이 입력될 때, **When** 도구를 실행하면, **Then** "유효하지 않은 OpenAPI 문서입니다" 오류 메시지와 해결 안내가 표시된다
3. **Given** 변환이 성공적으로 완료될 때, **When** 결과를 확인하면, **Then** "변환 완료: [출력 파일 경로]" 메시지가 표시된다
4. **Given** 알 수 없는 옵션이 입력될 때, **When** 도구를 실행하면, **Then** 오류 메시지와 사용법 힌트가 표시된다

---

### Edge Cases

- **인자 없이 실행**: 필수 인자 누락 오류 메시지와 사용법 힌트 표시 후 종료 코드 1 반환
- **OpenAPI v2 문서**: 지원하지 않는 버전임을 알리는 오류 메시지와 "v3로 변환 후 다시 시도하세요" 안내 표시
- **대용량 문서 (수백 개 API 항목)**: SC-001 기준(100개 항목 5초)에 비례하여 합리적인 시간 내 처리되어야 하며, 진행 상황을 stderr에 표시
- **출력 경로 쓰기 권한 없음**: 권한 오류 메시지와 해결 안내 표시 후 종료 코드 1 반환
- **출력 파일 이미 존재**: 기본적으로 오류 발생, `--force` 옵션 사용 시 덮어쓰기
- **알 수 없는 옵션**: 오류 메시지와 함께 도움말 참조 안내 표시
- **공백/특수문자 경로**: 따옴표로 감싸서 처리

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 도구는 OpenAPI v3 (3.0.x 및 3.1.x) 문서를 입력으로 받아야 한다
- **FR-002**: 도구는 YAML(.yaml, .yml) 및 JSON(.json) 형식의 OpenAPI 문서를 모두 지원해야 한다
- **FR-003**: 출력 파일은 XLSX(스프레드시트) 형식이어야 한다
- **FR-004**: 스프레드시트 파일은 다음 정보를 테이블 형태로 포함해야 한다:
  - API 경로
  - 요청 방식 (GET, POST, PUT, DELETE 등)
  - 요약 설명
  - 상세 설명
  - 요청 매개변수
  - 요청 본문 구조
  - 응답 상태 및 설명
- **FR-005**: 사용자는 `-o, --output` 옵션으로 출력 파일 경로를 지정할 수 있어야 한다
- **FR-006**: 기본 출력 파일명은 입력 파일명과 동일하되 확장자는 `.xlsx`로 변경된다
- **FR-007**: 출력 경로에 `.xlsx` 확장자가 없으면 자동으로 추가해야 한다
- **FR-008**: 출력 경로가 디렉토리인 경우 입력 파일명을 사용하여 해당 디렉토리에 저장해야 한다
- **FR-009**: 잘못된 입력에 대해 사용자가 이해할 수 있는 한국어 오류 메시지와 해결 안내를 표시해야 한다
- **FR-010**: 성공 시 종료 코드 0, 오류 시 종류에 따라 1-3 반환해야 한다
- **FR-011**: `-h, --help` 옵션으로 한국어 사용법을 표시해야 한다
- **FR-012**: `-v, --version` 옵션으로 버전 정보(버전 + 빌드 날짜)를 표시해야 한다
- **FR-013**: 출력 파일이 이미 존재하는 경우 기본적으로 오류를 반환하고, `-f, --force` 옵션 사용 시 덮어쓰기해야 한다
- **FR-014**: 인자 없이 실행 시 필수 인자 누락 오류 메시지와 사용법 힌트를 표시해야 한다
- **FR-015**: 알 수 없는 옵션 입력 시 오류 메시지와 도움말 참조 안내를 표시해야 한다
- **FR-016**: `--help`, `--version`이 다른 옵션/인자와 함께 사용되면 해당 정보만 출력하고 종료해야 한다
- **FR-017**: 출력 파일에 개요 시트를 포함해야 한다 (API 제목, 버전, 서버 URL, 설명)
- **FR-018**: 출력 파일에 인증 시트를 포함해야 한다 (보안 스키마 정보)

### Key Entities

- **OpenAPI 문서**: 입력으로 받는 API 명세 파일. 경로, 요청 방식, 매개변수, 구조 정보를 포함
- **API 항목**: API의 개별 경로와 요청 방식의 조합. 테이블의 주요 행 단위가 됨
- **매개변수**: 각 API 항목에 전달되는 입력값
- **요청 본문**: 요청 시 전달되는 데이터 구조
- **응답**: 각 API 항목의 결과 정의. 상태별 설명과 구조 포함
- **스프레드시트**: 출력 파일. 하나 이상의 시트로 구성

### CLI 인터페이스 요구사항

- **명령어 이름**: `otd` (OpenAPI To Document)
- **기본 구조**: `otd [옵션] <입력파일>`
- **옵션 순서**: 순서에 관계없이 동일하게 동작
- **출력 스트림**:
  - stdout: 성공 메시지, 도움말, 버전 정보
  - stderr: 오류 메시지, 진행 상황
- **경로 처리**: 상대/절대 경로 모두 지원, OS 네이티브 경로 구분자 자동 처리

### Assumptions

- OpenAPI 문서가 외부 파일을 참조하는 경우, 해당 파일도 함께 해석해야 한다
- 테이블 형식은 API 항목당 하나의 행을 기본으로 하되, 내용이 복잡한 경우 별도 시트나 중첩 표현을 사용할 수 있다
- 사용자 환경은 UTF-8 인코딩을 지원한다

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 일반적인 크기의 OpenAPI 문서(100개 이하 API 항목)를 5초 이내에 변환할 수 있다
- **SC-002**: 변환된 스프레드시트 파일은 주요 스프레드시트 프로그램(Excel, LibreOffice, Google Sheets)에서 정상적으로 열린다
- **SC-003**: 모든 API 항목 정보가 손실 없이 테이블에 포함된다
  - 검증 기준: FR-004에 정의된 모든 필드(API 경로, 요청 방식, 요약/상세 설명, 요청 매개변수, 요청 본문, 응답 상태)가 XLSX에 포함되어야 함
  - 테스트 방법: 입력 OpenAPI 문서의 API 항목 수와 출력 XLSX의 행 수가 일치하는지 확인
- **SC-004**: 오류 발생 시 사용자가 원인과 해결 방법을 파악할 수 있는 메시지가 모든 정의된 오류 케이스에서 제공된다
- **SC-005**: 도움말만으로 사용자가 기본 사용법을 이해할 수 있다
