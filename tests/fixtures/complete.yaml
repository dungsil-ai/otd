openapi: "3.1.0"
info:
  title: Complete API
  version: "2.0.0"
  description: |
    모든 기능을 테스트하기 위한 OpenAPI 문서입니다.
    여러 줄 설명을 포함합니다.
servers:
  - url: https://api.example.com/v2
    description: 운영 서버
  - url: https://staging-api.example.com/v2
    description: 스테이징 서버
tags:
  - name: users
    description: 사용자 관리
  - name: products
    description: 상품 관리
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API 키 인증
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰 인증
  schemas:
    User:
      type: object
      required:
        - id
        - email
      properties:
        id:
          type: integer
          format: int64
          description: 사용자 ID
        email:
          type: string
          format: email
          description: 이메일 주소
        name:
          type: string
          description: 사용자 이름
        createdAt:
          type: string
          format: date-time
          description: 생성 일시
    Product:
      type: object
      required:
        - id
        - name
        - price
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        price:
          type: number
          format: float
        tags:
          type: array
          items:
            type: string
    Order:
      type: object
      required:
        - id
        - userId
        - items
      properties:
        id:
          type: integer
          format: int64
          description: 주문 ID
        userId:
          type: integer
          format: int64
          description: 사용자 ID
        address:
          type: object
          description: 배송 주소
          properties:
            city:
              type: string
              description: 도시
            street:
              type: string
              description: 거리
            zipCode:
              type: string
              description: 우편번호
        items:
          type: array
          description: 주문 항목 목록
          items:
            type: object
            properties:
              productId:
                type: integer
                format: int64
                description: 상품 ID
              quantity:
                type: integer
                description: 수량
              price:
                type: number
                format: float
                description: 단가
    Error:
      type: object
      required:
        - code
      properties:
        code:
          type: string
          description: 오류 코드
        message:
          type: string
          description: 오류 메시지
paths:
  /users:
    get:
      tags:
        - users
      summary: 사용자 목록 조회
      description: 전체 사용자 목록을 조회합니다.
      operationId: getUsers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: 페이지 번호
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          required: false
          description: 페이지당 항목 수
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    post:
      tags:
        - users
      summary: 사용자 생성
      description: 새 사용자를 생성합니다.
      operationId: createUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
      responses:
        "201":
          description: 생성됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /users/{id}:
    get:
      tags:
        - users
      summary: 사용자 조회
      description: 특정 사용자의 정보를 조회합니다.
      operationId: getUserById
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 사용자 ID
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "404":
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    put:
      tags:
        - users
      summary: 사용자 수정
      description: 사용자 정보를 수정합니다.
      operationId: updateUser
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
      responses:
        "200":
          description: 수정됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    patch:
      tags:
        - users
      summary: 사용자 부분 수정
      description: 사용자 정보를 부분적으로 수정합니다.
      operationId: patchUser
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: X-Request-ID
          in: header
          required: false
          description: 요청 추적 ID
          schema:
            type: string
          example: "req-abc-123"
        - name: session_id
          in: cookie
          required: false
          description: 세션 ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: 사용자 이름
            examples:
              changeName:
                summary: 이름 변경
                value:
                  name: "홍길동"
              clearName:
                summary: 이름 초기화
                value:
                  name: ""
      responses:
        "200":
          description: 수정됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "404":
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    delete:
      tags:
        - users
      summary: 사용자 삭제
      description: 사용자를 삭제합니다.
      operationId: deleteUser
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: 삭제됨
        "404":
          description: 사용자를 찾을 수 없음
  /products:
    get:
      tags:
        - products
      summary: 상품 목록 조회
      operationId: getProducts
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: minPrice
          in: query
          schema:
            type: number
        - name: maxPrice
          in: query
          schema:
            type: number
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Product"
  /products/{id}:
    get:
      tags:
        - products
      summary: 상품 조회
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "404":
          description: 상품을 찾을 수 없음
  /users/{id}/avatar:
    post:
      tags:
        - users
      summary: 프로필 이미지 업로드
      description: 사용자 프로필 이미지를 업로드합니다.
      operationId: uploadAvatar
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: 이미지 파일
                description:
                  type: string
                  description: 이미지 설명
      responses:
        "200":
          description: 업로드 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: 업로드된 이미지 URL
        "400":
          description: 잘못된 파일 형식
  /orders:
    post:
      tags:
        - users
      summary: 주문 생성
      description: 새 주문을 생성합니다.
      operationId: createOrder
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Order"
      responses:
        "201":
          description: 주문 생성됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
              examples:
                simpleOrder:
                  summary: 단순 주문
                  value:
                    id: 1
                    userId: 100
                    address:
                      city: "서울"
                      street: "강남대로 1"
                      zipCode: "06000"
                    items:
                      - productId: 1
                        quantity: 2
                        price: 15000
        "400":
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
